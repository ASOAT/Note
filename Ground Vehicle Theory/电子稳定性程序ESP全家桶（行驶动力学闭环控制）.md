# 1 任务
如果超过轮胎附着系数，汽车的行驶突然与驾驶员期望的行驶不同。在这样的物理边界状况，仅依靠驾驶员本身常难以稳定汽车行驶，且由于其害怕和惊慌而使汽车更不稳定，其结果是汽车纵向行驶和骑车纵轴间夹角（航向角$\beta$） 更大。电子稳定性程序（ESP）（BOSCH称其为行驶动力学闭环控制）对减缓汽车在物理边界范围行驶、帮助驾驶员控制汽车做出重要贡献。

如下图所示，传感器不断检测汽车行驶状态，当实际状态与设定状态有显著偏差时，通过对制动系统和动力总成系统的干预可以稳定汽车行驶。
![[ESP01.png|C|550]]

作为总系统的ESP在其方案中超过ABS和ABS与ASR（Anti-Slip Regulation，驱动防滑转）系统的组合。ESP系统保证汽车在弯道行驶时汽车后部不会**过度转向**以及汽车前部不会**不足转向**。

---
# 2 要求（功能）
对于物理边界范围，在所有的行驶状况（如满制动、部分制动、车轮自由转动、驱动、滑行、载荷变化以及如在害怕反应、惊慌反应做出的极端操控方式等情况下），ESP系统可改善**汽车车辙和方向的散布范围**，借此降低汽车甩出的危险。

在汽车的各种行驶状况下，ABS、ASR、MSR（Motor control Slide Retainer,发动机阻力矩控制系统：在过高的发动机制动力矩时自动提高发动机转速）可以进一步**利用附着系数潜力**，从而**缩短制动距离**，**增大牵引力**以及**提高汽车的可操纵性和稳定性**。

ESP的安全设计要求极高，因为任何错误地干预ESP系统可能对安全都会产生重大影响。无缝隙的安全设计为了及时识别所有可避免的、不是根本的故障和完全或部分切断与故障类型有关的ESP系统。

在北美，到2011年11月有义务、逐步使用ESP系统。欧盟自2011年11月起所有新轿车和轻型商用车必须成批量配备行驶动力学闭环控制系统。

---
# 3 配备与未配备ESP系统的汽车行驶性能对比
针对方向盘快速转向和快速回转这一典型操作方法展开对比。
行驶条件：
（1）在结实的硬路面，摩擦系数$\mu=1$；
（2）驾驶员没有制动干预；
（3）车速为$144km/h$
![[ESP02.png|250]]![[ESP03.png|R|250]]

---
# 4 ESP总系统结构及工作原理

## 4.1 行驶动力学闭环控制目标
1. 将汽车在平面内的3个自由度**保持在可控的边界内**。
2. 在以合适的方式行驶时可按照驾驶员意愿并以与路面相适应的方式**优化汽车动态行驶性能**。

## 4.2 系统和控制结构
**受控对象**：汽车

确定控制输入参数的**传感器**：
- 描述驾驶员意愿的方向盘角度传感器信号
- 从液压调节器中测定的制动压力得到的预压力（初始压力）传感器
- 加速踏板（驱动扭矩）传感器
- 车轮转速传感器
- 横向加速度传感器
- 转动率传感器
- 预压力传感器

影响制动力、驱动力、侧向力的控制元件（**执行器**）

由上位横向动力学**控制器**和下位车轮控制器组成的分层机构**控制器**

![[ESP04.png]]

##  4.3 行驶状态估计
为确定对不稳定性的干预，不仅需要要了解**车轮速度**$v_{Rad}$、**预压力**$p_{Vor}$、**横摆速度**$\dot{\psi}$、**横向加速度**$a_y$、**方向盘角度**$\delta$的传感器信号和发动机扭矩。还需要了解其他一般方法无法直接测量的一系列其他参数，如**轮胎纵向力、横向力和法向力**（$F_x,F_y,F_z$），**汽车纵向速度**$v_x$,，**轮胎滑转率**$\lambda$，车桥上的**侧偏角**$\alpha$,**航向角**$\beta$，汽车横向速度$v_y$和附着系数$\mu$。这些参数依靠模型从观察器中的传感器信号**估计**而得。

汽车纵向速度$v_x$对所有基于车轮滑转率的控制器特别重要。以汽车模型为基础，依靠测量车轮速度就能高精度确定汽车纵向速度$v_x$，但还需要考虑众多影响因素：
- 在正常行驶状态由于**制动滑转或驱动滑转**，汽车纵向速度$v_x$与车轮速度$v_{Rad}$不同（需要特别注意全轮驱动汽车各车轮的特殊耦合）。
- 在**弯道**行驶时弯道内侧车轮随弯道外侧车轮转动，所以它们间的速度是不同的。

在正常行驶中，由于载荷不同，**行驶阻力变化**（如路面坡度或路面铺装不同，风阻）或摩阻（如制动摩擦衬片）影响,汽车动态行驶性能也会变化。

在这些条件下对车轮纵向速度的估计需要保证百分之几的偏差，以保证在必要时对汽车进行和加强不稳定干预。

## 4.4 基本的横向动力学控制器
基本任务：从横摆速度和从观察器中估计的航向角获得实际的汽车动态性能等和之后在行驶动力学边界范围中的汽车动态行驶性能，与在正常范围的汽车动态行驶性能（设定的汽车动态行驶性能）尽可能接近。

为确定设定的汽车动态行驶性能，利用**Bicycle model**可以得出：
$$\dot{\psi}=\frac{v_x}{L}\delta\frac{1}{1+(\frac{v_x}{v_{ch}})^2} $$
在该式中汽车模型的几何参数和物理参数汇集在汽车特征速度中。计算出横摆速度$\dot{\psi}$受当时的附着系数状况的制约，并与**汽车行驶动力学和行驶状态的特殊性能**（如驾驶员制动或加速）以及与如**倾斜路面**或**不同的附着系数路面**($\mu$-split)的特别路面状况相匹配。由此得知作为设定的横摆速度$\dot{\psi_{So}}$的**驾驶员意愿**。

横向动力学控制器将测定的横摆速度与设定的横摆速度比较，在规定必要的偏差后计算横摆力矩。为使**实际**的汽车动态行驶参数与它**设定**的汽车动态行驶参数**接近或相同**需要横摆力矩。对此，上位的横向动力学控制器监控**航向角**$\beta$，并随着$\beta$的不断增大，在计算不稳定的横摆力矩时要考虑**横摆力矩的变化**$\Delta M_Z$。横向动力学的输出参数通过下位车轮控制器预设的制动力矩和滑转率转换到各个车轮上，各个车轮由下位车轮控制器控制。

在车轮上实施不稳定性干预，车轮制动在需要的方向产生一个横摆力矩。在过度转向的汽车上，显示**后桥车轮**超过物理边界，因此通过**前桥车轮**实施不稳定性干预。不足转向则相反。

利用下位车轮控制器可以控制由横向动力学控制器要求的各车轮上的设定滑转率$\lambda_{So}^i$，需要区别下述三种应用情况

### 自由滚动
为尽可能精确地事假稳定汽车所需的横摆力矩，必须通过控制车轮**滑转率**改变车轮力。在没有制动情况下由下位驱动防滑转控制**ASR控制器**通过**主动建立制动液压力**控制来达到横向动力学控制器要求的车轮上设定的滑转率。

为此，应尽可能精确地知道当前车轮上的滑转率，滑转率由测定的**车轮转速**信号和观察器中获得的**汽车纵向速度**$v_x$确定。从实际的车轮滑转率与其设定值的偏差，通过**PID**控制算法可获得车轮上的设定制动力矩。

由横向动力学闭环控制主动建立制动液压力时也可能使车轮陷于制动滑转状态。

在抬起加速踏板或在中断供油时发动机运动件的惯性产生**作用在驱动轮上的制动力**，若该制动力或相应的制动力矩太大，则制动力矩不再由轮胎传递到路面，轮胎在此时趋于抱死（路面突然光滑）。驱动轮在自由滚动时的制动滑转可通过发动机倒拖力矩控制（如驾驶员少给点油）加以限制。

### 制动
制动时车轮上重叠多种功能：
- 驾驶员预设制动踏板位置和方向盘转角（驾驶员意愿）；
- 防止个别车轮抱死的ABS控制器工作；
- 为保证汽车稳定，横向动力学控制器干预，以在必要时有针对性地制动个别车轮。

如果制动时车轮控制的主要目标是达到汽车的**最大减速度**，则可以在车轮减速的基础上实施车轮控制，这时用较少的传感器信息确定车轮减速度。

如果为有针对性地控制**汽车纵向力和横向力**以**稳定汽车**，要应用**驱动防滑转控制**，因为其允许在附着系数——制动滑转率特性的不稳定范围控制车轮。从可供使用的传感器信息中，必须根据行驶速度将绝对的车轮滑转率精确到百分之几内。

ABS控制器的任务是在各种路况下尽可能保证汽车的**稳定性和可操纵性**，并尽可能充分**利用车轮和路面间的附着系数**。ABS控制器使横向动力学控制器的下位控制器，它还可修改制动液压力，以在保证**足够的侧向导向力**情况下尽最大可能施加**纵向力**。

如果在**弯道**制动，在某些条件下汽车开始偏转，可由**电子制动力分配装置**（EB）通过降低**过度转向趋向的个别车轮上的制动液压力**予以阻止。如果这还不够，横向动力学控制器可通过**弯道外侧前轮**主动建立制动液压力（**降低侧向力**）帮助克服汽车偏转。在不足转向时，少许增加**弯道内侧后轮**的制动力矩，少许降低**弯道外侧前轮**制动力矩。过度转向时则反之。

在满制动或部分制动时，汽车开始过度转向**变换车道**，则具有针对性地降低弯道内侧后轮的制动液压力（**提高侧向力**）。

### 驱动
只要在驱动时驱动轮开始滑转，则**下位驱动ASR控制器**激活。通过改变每个驱动轮上的力矩平稳可影响测定的**车轮速度**和响应的**驱动滑转率**。ASR控制器限制每个驱动轮在行驶路面可传递的驱动扭矩，可以尽可能在物理边界范围保证驾驶员**加速意愿**，并同时保证基本的**汽车行驶稳定性**（不大幅降低车轮侧向力）。

![[ESP05.png]]
其中：
$$v_{MRd}(驱动桥的车轮平均速度)=\frac{1}{2}(v_{Rad}^L+v_{Rad}^R)$$
$$v_{Dif}(作为控制参数) = v_{Rad}^L-v_{Rad}^R$$

在计算同一车桥上驱动轮的设定车轮速度差$v_{DifSo}$和设定的车轮平均速度$v_{MRdSo}$时，驱动桥上车轮的设定滑转率变化$\Delta \lambda_{So}$和驱动桥上车轮的设定的允许滑转率变化$\Delta \lambda_{DifTolSo}$的预设值以补偿方式影响ASR控制器。

由横向动力学识别出的不足转向和过度转向趋向通过设定高的发动机扭矩降低的变化$\Delta M_{RedSo}$直接确定允许的最大驱动扭矩。

动力传动转置的动力学取决于非常不同的工作状况。因此为使控制参数与地面动力学和非线性匹配需要获得当前的工作状况（挂的变速器党委、离合器操纵）。整个动力传动装置（发动机、变速箱、万向轴和驱动轮）的可变惯性矩影响车轮平均速度、通过PID控制器控制车轮平均速度，其输出参数是设定的总扭矩$M_{RedSo}$

同一车桥上驱动轮速度差较小，因此与驱动轮平均速度相反，驱动轮速度差只受发动机间接影响。为控制同一车桥上驱动轮速度差$v_{Diff}$，使用一种非线性控制器。在一个驱动轮上的制动干预首先只在该车轮的扭矩平衡时才能察觉到，所以制动干预改变横向差速器的扭矩分配比，并借此产生差速器闭锁。横向差速器闭锁控制器的控制参数受行驶速度级（变速器档位）和发动机的影响甚微。如果在同一驱动桥上设定的驱动轮速度差比允许的当前的驱动轮速度差大得多，则开始计算设定的扭矩差$M_{DiffSo}$。

设定的总扭矩和设定的扭矩差是将侧向力分配在执行机构上的基础。设定的扭矩差$M_{DiffSo}$由左右驱动轮之间的制动力矩差经液压调节器中的响应控制阀控制（不对称制动干预）。通过发动机干预和对称的制动干预可以控制设定的总扭矩$M_{MRdSo}$。

## 4.5 横向动力学附加功能
一般多功能运动车（SUV）或者轻型货车需要ESP有一些附加功能

### 1 进一步抑制转向不足
当弯道行驶路面突然潮湿或者脏污时，按正常的行驶方式汽车可能不再跟随驾驶员预设的转向而转向。ESP系统可以通过事假附加的横摆力矩提高汽车横摆速度，这样就能以物理学上的可能的最高速度通过弯道。

如果驾驶员要求比物理边界范围可能得更小转向半径，则只能降低汽车的行驶速度。从稳态弯道行驶中推出关系式：
$$r = \frac{v_x}{\dot{\psi}}$$
为保证所希望的车道变化，可针对性地分配各车轮制动力，在需要时完全制动汽车而不出现横摆，增强不足转向控制（EUC，Enhanced Understeering Control）。

### 2 阻止倾翻
针对轻型商用车和高重心的其他车辆。在使用ESP系统时，RMF（Rollover Mitigation Functions）可以识别临界的行驶状态，并通过制动控制和发动机控制干预稳定汽车。如果识别出即将发生倾翻危险，则针对制动弯道外侧的两个车轮，降低其侧向力，从而减小造成倾翻危险的横向加速度。此外，在准稳态行驶状态可及时降低发动机扭矩，使驾驶员克服危险的倾翻状态。

对于SUV等对载荷有特殊需求的车辆（车顶行李舱等），采用可以确定汽车重量和由于载荷分布变化而需要重新确定重心位置的估算算法，该算法也是ESP系统功能载荷自适应控制（LAC，Load Adaptive Control）需要的。

### 3 装有牲畜的车辆稳定性
（很怪的标题，但实际上讲的是半挂车的横向运动控制，出于某种恶趣味还是把原书的标题保留了）
半挂车容易绕车辆垂直轴摆动，且与行驶速度有关。如果车辆低于临界速度慢速行驶，则衰减摆动运动。如果半挂车快速行驶，则由于小的转向、侧向风或驶过隧道而出现摆动运动并很快增强，接着由于车辆折叠而发生事故。

减轻挂车摆动（TSM，Trailer Sway Mitigation）功能基于模型的分析并考虑驾驶员转向运动识别挂车摆动。如果摆动运动达到临界值，则自动制动并将车速降低到在出现最小的激励情况下不会马上产生危险的振动。

### 4 行驶动力学附加调节器的控制
除了利用液压车轮制动器以外，还有能影响汽车行驶动力学性能的其他执行机构、将主动转向系统、底盘系统与ESP系统组合成为汽车动态管理系统（VDM，Vehicle Dynamics Management）。

在全轮驱动汽车上，通过两个驱动桥上的中间部分分配驱动扭矩。如果发动机扭矩首先作用在一个驱动桥上，则通过中间部件耦合到第二个驱动桥上，称为坡度结合系统（Hang-On-System）。如果中间部件为一个开式差速器，则当一个驱动桥上的车轮具有较大的滑转率就会出现驱动扭矩限制。此时如果车轮滑转就没有牵引力。在与ESP系统组合时，全轮ASR控制器的对称制动干预可限制两驱动桥间的速度差，达到纵向闭锁效果。
![[ESP06.png]]

除两个驱动桥的简单耦合外，还有可控的中间闭锁。中间闭锁时，电动或液压执行机构控制两驱动桥耦合，并与闭锁力矩匹配。利用ESP系统行驶动力学信息和附加考虑行驶动力学调节器的专门参数，可使两驱动桥的耦合与当前的汽车行驶状态最佳匹配（中央扭矩动态耦合 DCT-C，Dynamic Coupling Torque at Center）

在弯道行驶出现过度转向时，暂时将更多驱动扭矩叠加给前桥车轮，为避免汽车不稳定行驶，首先必须较晚地降低发动机扭矩或甚至用制动干预稳定汽车。如果汽车较早趋于不足转向，则通过将驱动扭矩叠加在后桥车轮上来减弱不足转向。
![[ESP07.png]]
从原理上，车轮动态扭矩分配（DWT，Dynamic Wheel Torque Distribution）与通过ASR系统由液压车轮制动器实现横向闭锁没有多大区别，但是控制损失小，操作体验更加细腻、舒适。

## 4.6 系统部件
![[ESP08.png]]
### 1 电控单元
PCB板：
- 两个核心计算机
- 阀和泵控制的驱动器
- 半导体继电器
- 传感器信号与处理的接口电路
- 辅助信号（制动灯开关）的相应开关输入电路
- CAN和FlexRay接口

### 2 液压调节器
将电控单元的控制命令转化为制动液压力，并通过电磁阀调节车轮制动缸中的制动液压力。
![[ESP09.png]]

ESP系统需要12个电磁阀，大多还组合一个压力传感器。压力传感器通过测定主制动缸中的制动液压力感知驾驶员对汽车的减速意愿，从而在部分主动制动操纵时提高汽车稳定性。ESP控制时（主动控制）液压调节器的压力调节与ABS控制时（被动控制）液压调节器的压力调节原理一致。

因为ESP是主动建议制动液压力，所以每个制动回路用自吸式柱塞泵代替ABS中使用的回液式柱塞泵。车轮制动缸和主制动缸通过常开转换法（USV）和高压开关阀（HSV）连通。

### 监控系统
正如前文所述，ESP是对安全要求极高的系统，因此一个综合性的安全监控系统对ESP的无漏洞、可靠运转是至关重要的。

传感器按若干阶段被监控：
- 对传感器的连接电缆断路、以及信号的不合理性（超量程检查，干扰检测，物理上的合理性）进行连续的监控。
- 对最重要的传感器单独进行试验。
- 当汽车稳态行驶时，采用备用分析功能来监控传感器。此时应用汽车计算模型来校核各个传感器信号之间的相互关系来确定是否异常。


ESP的内容到此就先告一段落，本文的大部分内容来自于BOSCH的汽车工程手册，首先不得不吐槽一下整本书虽然内容齐全详细但是机翻的中文还是令人难受。主要内容已经经过整理总和在此处，但还有一些细节例如液压系统的具体工作方式由于篇幅原因还是没有整理上来。其他特殊场景例如越野场景下ESP的工作亦或是商用车的特殊行驶动力学闭环控制也都没有整理，感兴趣的可以自行查阅。